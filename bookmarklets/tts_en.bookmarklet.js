javascript:window.slang="en-EN";function processText(e){let t=e.replace(/\n/g," ").replace(/\t/g," ");for(;t.includes("  ");)t=t.replace(/  /g," ");return createSentences(t.split(" "))}function createSentences(e){let t=[],n="";for(;e.length>0;){let s=e.shift();n.length+s.length+1>200?(e.unshift(s),t.push(n.trim()),n=""):(n+=" "+s).length>50&&s.endsWith(".")&&(t.push(n.trim()),n="")}return n.trim().length>0&&t.push(n.trim()),t}function speakNext(){if(0==window.sss.length){console.log("THE END");return}let e=window.sss.shift();var t=new SpeechSynthesisUtterance(e);t.lang=window.slang,console.log("speaking:",e),t.onend=function(e){console.log("SpeechSynthesisUtterance.onend"),window.speechSynthesis.cancel(),speakNext()},t.onerror=function(e){console.error("SpeechSynthesisUtterance.onerror",e.error)},window.speechSynthesis.speak(t)}window.speechSynthesis.cancel(),window.sss=processText(window.getSelection().toString()),speakNext();
